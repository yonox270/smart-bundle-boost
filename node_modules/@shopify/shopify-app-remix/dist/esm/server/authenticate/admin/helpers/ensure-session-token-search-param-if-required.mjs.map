{"version":3,"file":"ensure-session-token-search-param-if-required.mjs","sources":["../../../../../../../src/server/authenticate/admin/helpers/ensure-session-token-search-param-if-required.ts"],"sourcesContent":["import {BasicParams} from '../../../types';\n\nimport {redirectToBouncePage} from './redirect-to-bounce-page';\n\nconst SESSION_TOKEN_PARAM = 'id_token';\n\nexport const ensureSessionTokenSearchParamIfRequired = async (\n  params: BasicParams,\n  request: Request,\n) => {\n  const {api, logger} = params;\n  const url = new URL(request.url);\n\n  const shop = url.searchParams.get('shop')!;\n  const searchParamSessionToken = url.searchParams.get(SESSION_TOKEN_PARAM);\n  const isEmbedded = url.searchParams.get('embedded') === '1';\n\n  if (api.config.isEmbeddedApp && isEmbedded && !searchParamSessionToken) {\n    logger.debug(\n      'Missing session token in search params, going to bounce page',\n      {shop},\n    );\n    redirectToBouncePage(params, url);\n  }\n};\n"],"names":[],"mappings":";;AAIA,MAAM,mBAAmB,GAAG,UAAU;AAE/B,MAAM,uCAAuC,GAAG,OACrD,MAAmB,EACnB,OAAgB,KACd;AACF,IAAA,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,MAAM;IAC5B,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC;IAEhC,MAAM,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAE;IAC1C,MAAM,uBAAuB,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,mBAAmB,CAAC;AACzE,IAAA,MAAM,UAAU,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,GAAG;IAE3D,IAAI,GAAG,CAAC,MAAM,CAAC,aAAa,IAAI,UAAU,IAAI,CAAC,uBAAuB,EAAE;QACtE,MAAM,CAAC,KAAK,CACV,8DAA8D,EAC9D,EAAC,IAAI,EAAC,CACP;AACD,QAAA,oBAAoB,CAAC,MAAM,EAAE,GAAG,CAAC;IACnC;AACF;;;;"}